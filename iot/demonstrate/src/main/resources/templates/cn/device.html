<!doctype html>
<html>
<head>
<meta http-equiv="content" content="text/html" charset="utf-8"/>
<link href="/font-awesome/css/font-awesome.css" rel="stylesheet" type="text/css"/>
<link href="/css/tc/device.css" rel="stylesheet" type="text/css"/>
<script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/tc/plugins/echart/echarts.min.js"></script>
<script src="/js/common.js"></script>
<script type="text/javascript" src="/js/menu.js"></script>
<script type="text/javascript" src="/js/plugins/yingshi/ezuikit.js"></script>
<style type="text/css">
#myPlayer{
	width:100%;
}
.controlDiv >div{
	text-align:center;
}
button{
	cursor:pointer;
}
</style>
</head>
<body>
<div id="toggleMenu">
    <a href="/index" style="padding:6px;color:#fff">首页</a><a href="/cn/analysis" style="padding:6px;color:#fff">平台概貌</a><a href="/cn/device" style="padding:6px;color:#fff">设备管理</a><a href="/cn/scene" style="padding:6px;color:#fff">应用展示</a>
	<!-- <a href="javascript:void(0)" onclick="maxsize()"><img src="/img/maxsize.png" width="17px"/></a> -->
</div>
<div id="container">
	<!--<div id="header">
		<h3 class="header_title">温室大棚智能控制云平台监控将界面</h3>
	</div>-->
	<div id="mainContent">
		<div id="asideMenu">
			<div id="menuTitle" style="background-color:#dadad7">
				<h3  id="myDevice">我的设备</h3>
			</div>
			<ul id="device_list">
				<li style="background-color:#dadad7;border-bottom:2px solid #fff">
					园区监测
				</li>
			</ul>
            <ul style="background-color:#dadad7" id="outerUl">
            </ul>
		</div>
		<div id="splitIcon"><img src="/img/icon_left.png" style=" width: 9px;height: 45px;"/></div>
		<div id="innerContent">
			<div id="content_header">
				<h4  class="content_title">采集数据</h4>
			</div>
			<div id="content_main">
				<ul class="list">
					<!-- 温湿度 -->
					<li class="wd">
						<div class="float_left">
							<div class="device_identify">
								<img src="/img/wd_2.png"/><br/>
								<span class="devName"></span>
							</div>
						</div>
						<div class="float_left">
							<span>温度</span>
							<p class="current_state">当前状态：<span class="online">已连接</span></p>
							<div class="update_time">更新时间：<span class="updateTime"></span></div>
						</div>
						<div class="float_left" style="line-height: 75px;"> 
							<span class="data_number"></span> &#8451;
						</div>
						<div class="float_left">
							<a href="javascript:void(0)" class="analize_line"><i class="fa fa-chevron-down"></i> 历史曲线</a>
						</div>
						<div style="clear:both"></div>
						<div class="echart_cont">
							<div id="echart_wd" style="width:100%;height:100%;"></div>
						</div>
					</li>
					<li class="sd">
						<div class="float_left">
							<div class="device_identify">
								<img src="/img/sd_4.png"/><br/>
								<span class="devName"></span>
							</div>
						</div>
						<div class="float_left">
							<span>湿度</span>
							<p class="current_state">当前状态：<span class="online">已连接</span></p>
							<div class="update_time">更新时间：<span class="updateTime"></span></div>
						</div>
						<div class="float_left" style="line-height: 75px;"> 
							<span class="data_number"></span> %RH
						</div>
						<div class="float_left">
							<a href="javascript:void(0)" class="analize_line"><i class="fa fa-chevron-down"></i> 历史曲线</a>
						</div>
						<div style="clear:both"></div>
						<div class="echart_cont">
							<div id="echart_sd" style="width:100%;height:100%;"></div>
						</div>
					</li>
					<!-- 烟感 -->
					<li class="bj">
						<div class="float_left">
							<div class="device_identify">
								<img src="/img/yg.png"/><br/>
								<span class="devName"></span>
							</div>
						</div>
						<div class="float_left">
							<span>报警状态</span>
							<p class="current_state">当前状态：<span class="online">已连接</span></p>
							<div class="update_time">更新时间：<span class="updateTime"></span></div>
						</div>
						<div class="float_left" style="line-height: 75px;"> 
							<span class="data_number"></span> 
						</div>
						<div style="clear:both"></div>
					</li>
					<li class="dy">
						<div class="float_left">
							<div class="device_identify">
								<img src="/img/yg.png"/><br/>
								<span class="devName"></span>
							</div>
						</div>
						<div class="float_left">
							<span>电压</span>
							<p class="current_state">当前状态：<span class="online">已连接</span></p>
							<div class="update_time">更新时间：<span class="updateTime"></span></div>
						</div>
						<div class="float_left" style="line-height: 75px;"> 
							<span class="data_number"></span> V
						</div>
						<div class="float_left">
							<a href="javascript:void(0)" class="analize_line"><i class="fa fa-chevron-down"></i> 历史曲线</a>
						</div>
						<div style="clear:both"></div>
						<div class="echart_cont">
							<div id="echart_dy" style="width:100%;height:100%;"></div>
						</div>
					</li>
					<!-- 地磁 -->
					<li class="tczt">
						<div class="float_left">
							<div class="device_identify">
								<img src="/img/dc.png"/><br/>
								<span class="devName"></span>
							</div>
						</div>
						<div class="float_left">
							<span>停车状态</span>
							<p class="current_state">当前状态：<span class="online">已连接</span></p>
							<div class="update_time">更新时间：<span class="updateTime"></span></div>
						</div>
						<div class="float_left" style="line-height: 75px;"> 
							<span class="data_number"></span> 
						</div>
						<div style="clear:both"></div>
					</li>
					<li class="tcdc">
						<div class="float_left">
							<div class="device_identify">
								<img src="/img/dc.png"/><br/>
								<span class="devName"></span>
							</div>
						</div>
						<div class="float_left">
							<span>温度</span>
							<p class="current_state">当前状态：<span class="online">已连接</span></p>
							<div class="update_time">更新时间：<span class="updateTime"></span></div>
						</div>
						<div class="float_left" style="line-height: 75px;"> 
							<span class="data_number"></span> &#8451; 
						</div>
						<div class="float_left">
							<a href="javascript:void(0)" class="analize_line"><i class="fa fa-chevron-down"></i> 历史曲线</a>
						</div>
						<div style="clear:both"></div>
						<div class="echart_cont">
							<div id="echart_dc" style="width:100%;height:100%;"></div>
						</div>
					</li>
					<li class="pm">
						<div class="float_left">
							<div class="device_identify">
								<img src="/img/pm.png"/><br/>
								<span class="devName"></span>
							</div>
						</div>
						<div class="float_left">
							<span>pm2.5</span>
							<p class="current_state">当前状态：<span class="online">已连接</span></p>
							<div class="update_time">更新时间：<span class="updateTime"></span></div>
						</div>
						<div class="float_left" style="line-height: 75px;"> 
							<span class="data_number"></span> 
						</div>
						<div class="float_left">
							<a href="javascript:void(0)" class="analize_line"><i class="fa fa-chevron-down"></i> 历史曲线</a>
						</div>
						<div style="clear:both"></div>
						<div class="echart_cont">
							<div id="echart_pm" style="width:100%;height:100%;"></div>
						</div>
					</li>
					<li class="ph">
						<div class="float_left">
							<div class="device_identify">
								<img src="/img/ph.png"/><br/>
								<span class="devName"></span>
							</div>
						</div>
						<div class="float_left">
							<span>ph</span>
							<p class="current_state">当前状态：<span class="online">已连接</span></p>
							<div class="update_time">更新时间：<span class="updateTime"></span></div>
						</div>
						<div class="float_left" style="line-height: 75px;"> 
							<span class="data_number"></span> 
						</div>
						<div class="float_left">
							<a href="javascript:void(0)" class="analize_line"><i class="fa fa-chevron-down"></i> 历史曲线</a>
						</div>
						<div style="clear:both"></div>
						<div class="echart_cont">
							<div id="echart_ph" style="width:100%;height:100%;"></div>
						</div>
					</li>
					<!-- 摄像头 -->
					<li class="camera">
						<div class="float_left">
							<div class="device_identify">
								<img src="/img/camera.png"/><br/>
								<span class="devName"></span>
							</div>
						</div>
						<div style="clear:both"></div>
						<div style="width: 600px;margin: 10px auto;">
							<video id="myPlayer" poster="" controls="controls" playsInline="" webkit-playsinline="" autoplay="autoplay">
    							<source src="rtmp://rtmp.open.ys7.com/openlive/14f0b0d5d8754eafb9fef9a93f4861e7" type="" />
    							<source src="http://hls.open.ys7.com/openlive/14f0b0d5d8754eafb9fef9a93f4861e7.hd.m3u8" type="application/x-mpegURL" />
							</video>
							<div style="padding-top:10px;text-align:center;">
								<button onclick='move_device_by_derection(0)'><img src="/img/up.png" width="30px" height="25px"/></button>
								<button onclick='move_device_by_derection(1)'><img src="/img/down.png" width="30px" height="25px"/></button>
								<button onclick='move_device_by_derection(2)'><img src="/img/left.png" width="30px" height="25px"/></button>
								<button onclick='move_device_by_derection(3)'><img src="/img/right.png" width="30px" height="25px"/></button>
								<button onclick='move_device_by_derection(8)'><img src="/img/fd.png" width="30px" height="25px"/></button>
								<button onclick='move_device_by_derection(9)'><img src="/img/sx.png" width="30px" height="25px"/></button>
								<button onclick='move_device_by_derection(11)'><img src="/img/yuan.png" width="30px" height="25px"/></button>
								<button onclick='move_device_by_derection(10)'><img src="/img/jin.png" width="30px" height="25px"/></button>
							</div>
						</div>
					</li>
					<!-- 电表 -->
					<li class="ammeter">
                        <div class="float_left">
                            <div class="device_identify">
                                <img src="/img/ammeter.png"/><br/>
                                <span class="devName"></span>
                            </div>
                        </div>
                        <div class="float_left">
                            <span>电表</span>
                            <p class="current_state">当前状态：<span class="online">已连接</span></p>
                            <div class="update_time">更新时间：<span class="updateTime"></span></div>
                        </div>
                        <div class="float_left" style="line-height: 75px;">
                            <span class="data_number"></span> kWh
                        </div>
                        <div class="float_left">
                            <a href="javascript:void(0)" class="analize_line"><i class="fa fa-chevron-down"></i> 历史曲线</a>
                        </div>
                        <div style="clear:both"></div>
                        <div class="echart_cont">
                            <div id="echart_ammeter" style="width:100%;height:100%;"></div>
                        </div>
					</li>
                    <!-- 水表 -->
                    <li class="watermeter">
                        <div class="float_left">
                            <div class="device_identify">
                                <img src="/img/watermeter.png"/><br/>
                                <span class="devName"></span>
                            </div>
                        </div>
                        <div class="float_left">
                            <span>水表</span>
                            <p class="current_state">当前状态：<span class="online">已连接</span></p>
                            <div class="update_time">更新时间：<span class="updateTime"></span></div>
                        </div>
                        <div class="float_left" style="line-height: 75px;">
                            <span class="data_number"></span>  m3
                        </div>
                        <div class="float_left">
                            <a href="javascript:void(0)" class="analize_line"><i class="fa fa-chevron-down"></i> 历史曲线</a>
                        </div>
                        <div style="clear:both"></div>
                        <div class="echart_cont">
                            <div id="echart_watermeter" style="width:100%;height:100%;"></div>
                        </div>
                    </li>
					<!-- 开关 -->
					<li class="switch">
						<div class="float_left">
							<div class="device_identify">
								<img src="/img/switch.png"/><br/>
								<span class="devName"></span>
							</div>
						</div>
						<div class="float_left">
							<span>开关</span>
							<p class="current_state">当前状态：<span class="online">已连接</span></p>
							<div class="update_time">更新时间：<span class="updateTime"></span></div>
						</div>
						<div class="float_left" style="line-height: 75px;"> 
							<span class="data_number"><img src="/img/on.png" width="45px" id="switchState"/></span>
						</div>
						<div class="float_left">
							<a href="javascript:void(0)" class="analize_line"><i class="fa fa-chevron-down"></i> 历史曲线</a>
						</div>
						<div style="clear:both"></div>
						<div class="echart_cont">
							<div id="echart_switch" style="width:100%;height:100%;"></div>
						</div>
					</li>
                    <!-- 测试 -->
					<li class="switch_test">
						<div class="float_left">
							<div class="device_identify">
								<img src="/img/switch.png"/><br/>
								<span class="devName"></span>
							</div>
						</div>
						<div class="float_left">
							<span>开关</span>
							<p class="current_state">当前状态：<span class="online">已连接</span></p>
							<div class="update_time">更新时间：<span class="updateTime"></span></div>
						</div>
						<div class="float_left" style="line-height: 75px;"> 
							<span class="data_number"><img src="/img/on.png" width="45px" id="switchState_test"/></span>
						</div>
						<div class="float_left">
							<a href="javascript:void(0)" class="analize_line"><i class="fa fa-chevron-down"></i> 历史曲线</a>
						</div>
						<div style="clear:both"></div>
						<div class="echart_cont">
							<div id="echart_switch_test" style="width:100%;height:100%;"></div>
						</div>
					</li>
				</ul>
			</div>
	`	</div>
	</div>
</div>
<script type="text/javascript" src="/js/tc/data_init.js"></script>
<script>
$(function(){
	initMenu("/api/v1/menu?type=1");
	//initMenu();
	var id = getUrlParam("id");
	if(id){
		$("a[class ^='menu_"+id+"_']").trigger("click");
	} else {
		$("#outerUl>li:first-child>ul>li:first-child>a").trigger("click");
		//$(".menu_5_4").trigger("click");
	}
	$("li.active").parent().prev(".menu_title").find("i").removeClass("arrow_right").addClass("arrow_bottom");
})
function maxsize(){
	$("#toggleMenu").slideUp();
}
$(".analize_line").each(function(){
	$(this).click(function(){
		var echart_cont = $(this).parent().parent().find(".echart_cont");
		if(echart_cont.css("display")=="none"){
			echart_cont.show();
		} else {
			echart_cont.hide();
		}
	})
})
$("#splitIcon").bind("click",function(){
	if($("#asideMenu").css("display")=="none"){
		$("#asideMenu").show();
		$(this).css("left","241px");
		$(">img",$(this)).attr("src","./img/icon_left.png");
		$("#innerContent").css("marginLeft","251px");
	} else {
		$("#asideMenu").hide();
		$(this).css("left",0);
		$(">img",$(this)).attr("src","./img/icon_right.png");
		$("#innerContent").css("marginLeft",0);
	}
})
var thisDev;
var interval,intervalHy;
function addActive(target){
	var targets=[];
	if(interval){
		clearInterval(interval);
		clearInterval(intervalHy);
	}
	$(".innerUl >li").removeClass("active");
	$(".innerUl").hide();
	$(target).parent().addClass("active");
	$(target).parent().parent().show();
	$("i.arrow_bottom").removeClass("arrow_bottom").addClass("arrow_right");
	$("li.active").parent().prev(".menu_title").find("i").removeClass("arrow_right").addClass("arrow_bottom");
	var thisClass = $(target).attr("class").split("_");
	/*if(thisClass[1]==5){
		thisDev= 10;
	} else if(thisClass[1]==1){
		thisDev= 7;
	} else if(thisClass[1]==24){
		thisDev= 26;
	}else {
		thisDev= thisClass[1];
	}*/
	thisDev= thisClass[1];
	thisType = thisClass[2];
	$(".devName").html($(target).html());
	//$(".data_number").html(0);
	$(".list>li").hide();
	if(thisType==4){
		$(".wd,.sd").show();
		targets=["echart_wd","echart_sd"];
	} else if(thisType==19){
		$(".bj,.dy").show();
		targets=["echart_dy"];
	} else if(thisType==12){
		$(".tczt,.tcdc").show();
		targets=["echart_dc"];
	} else if(thisType==20){
		$(".pm").show();
		targets=["echart_pm"];
	} else if(thisType==21){
		$(".ph").show();
		targets=["echart_ph"];
	} else if(thisType==22){
		$(".camera").show();
		return;
	} else if(thisType==23){
		$(".switch_test").show();
		targets=["echart_switch_test"];
	}else if(thisType==13){
        $(".ammeter").show();
        targets=["echart_ammeter"];
    }else if(thisType==14){
        $(".switch").show();
        targets=["echart_switch"];
    }else if(thisType==15){
        $(".watermeter").show();
        targets=["echart_watermeter"];
    }
	readData(thisDev,thisType);
	interval = window.setInterval(function(){readData(thisDev,thisType)}, 1000);
	
	initChart(targets,thisDev,thisType);
}
</script>
<script>

	var player = new EZUIPlayer('myPlayer');
    player.on('error', function(){
        console.log('error');
    });
    player.on('play', function(){
        console.log('play');
    });
    player.on('pause', function(){
        console.log('pause');
    });


    var controllerUrl = '/device/ptz/start';//控制URL
	var stopUrl = '/device/ptz/stop';//停止控制URL
	var getTokenUrl = '/token/get';
	var accessToken = getToken();
	var deviceSerial = '110673568';
	var channelNo = '1'
	var direction = 2
	var speed = 1;
	var AppKey = '635ddf89ddb94b6694984617fc366451';
	var Secret = 'e9742334492aed30d9a1b703c26ccd53';
	
	function move_device_by_derection(direction){
		move_device(accessToken,deviceSerial,channelNo,direction,speed);
	}
	/*
	*speed
	*direction:操作命令：0-上，1-下，2-左，3-右，4-左上，5-左下，6-右上，7-右下，8-放大，9-缩小，10-近焦距，11-远焦距
	*/
	function move_device(accessToken,deviceSerial,channelNo,direction,speed){
		var data = {'accessToken':accessToken,'deviceSerial':deviceSerial,'channelNo':channelNo,'direction':direction,'speed':speed};
		$.ajax({
				url: controllerUrl,
			    datatype: 'json',
			    type: "Post",
			    data:data,
			    async:false,
			    success: function (data) {
					var code = data.code;
			    	if(code=='200'){//调用成功
			    		
			    	}else if(code=='10002'){//accessToken异常或过期
			        	
			        }
			    }
		});
		
		setTimeout(function(){
			$.ajax({
					url: stopUrl,
					datatype: 'json',
					type: "Post",
					data:data,
					async:false,
					success: function (data) {
						
					}
			});
		},600)
	}
	
	/*
	*停止控制设备
	*/
	function stop_device(accessToken,deviceSerial,channelNo,direction){
		var data = {'accessToken':accessToken,'deviceSerial':deviceSerial,'channelNo':channelNo,'direction':direction};
		$.ajax({
				url: stopUrl,
			    datatype: 'json',
			    type: "Post",
			    data:data,
			    success: function (data) {
					
			    }
		});
	}
	
	function getToken(){
		var accessToken='';
		$.ajax({
			url: getTokenUrl,
		    datatype: 'json',
		    type: "GET",
		    async:false,
		    success: function (data) {
		    	accessToken=data;
		    }
		});
		return accessToken;
	}
	
</script>
</body>
</html>